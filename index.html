<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIXE Portal V13</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* CSS NATIVE DENGAN FOKUS RESPONSIVITAS */
        :root {
            --bg: #0a0a0a;
            --card: #141414;
            --primary: #6d28d9; /* Deep Purple */
            --accent: #d946ef; /* Neon Pink */
            --text: #ffffff;
            --border: #2a2a2a;
            --success: #00c853;
            --error: #ff3b30;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
            user-select: none;
            /* Perbaikan Font Rendering di Mobile */
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif;
            margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh;
            padding-bottom: 80px;
        }

        /* HEADER */
        .header {
            padding: 15px 20px; background: rgba(10,10,10,0.9);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 50;
        }
        .logo { 
            font-weight: 900; font-size: 22px; letter-spacing: -1px; 
            background: linear-gradient(45deg, #fff, var(--accent)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }
        .wallet-btn {
            background: #1a1a1a; border: 1px solid #333; color: #fff;
            padding: 8px 14px; border-radius: 20px; font-size: 12px; font-weight: 600;
            cursor: pointer; transition: 0.2s;
        }
        .wallet-btn.connected { border-color: var(--success); color: var(--success); background: rgba(0,200,83,0.1); }

        /* TABS (Responsif) */
        .tabs { 
            display: flex; padding: 10px 15px; gap: 10px; overflow-x: auto; 
            position: sticky; top: 55px; z-index: 40; background: var(--bg);
            border-bottom: 1px solid var(--border);
        }
        .tab-btn {
            flex-shrink: 0; /* Penting untuk responsif */
            padding: 10px 15px; border-radius: 10px; background: #1a1a1a; color: #888;
            border: none; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        /* CONTAINER */
        .container { max-width: 500px; width: 100%; margin: 0 auto; }
        .view { display: none; padding: 15px; animation: fade 0.3s; }
        .view.active { display: block; }
        @keyframes fade { from{opacity:0; transform:translateY(5px)} to{opacity:1; transform:translateY(0)} }

        /* CARDS & INPUTS */
        .card { 
            background: var(--card); border-radius: 16px; padding: 20px; 
            border: 1px solid var(--border); margin-bottom: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .input-box {
            background: #000; border: 1px solid var(--border); border-radius: 12px;
            padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
        }
        .input-col { display: flex; flex-direction: column; gap: 5px; width: 60%; }
        .label { font-size: 11px; color: #666; }
        .amount { background: none; border: none; color: white; font-size: 22px; font-weight: 700; width: 100%; }
        
        .token { background: #222; padding: 6px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .token img { width: 20px; height: 20px; border-radius: 50%; object-fit: cover; }

        .swap-arrow { text-align: center; margin: -15px 0; position: relative; z-index: 2; }
        .arrow-circle { width: 32px; height: 32px; background: #222; border: 3px solid var(--card); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: #888; cursor: pointer; }

        .btn-main {
            width: 100%; padding: 16px; border-radius: 12px; border: none;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; font-size: 16px; font-weight: 700; margin-top: 15px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(109, 40, 217, 0.4);
            transition: 0.2s;
        }
        .btn-main:disabled { background: #333; color: #666; box-shadow: none; cursor: default; }
        .btn-main:active:not(:disabled) { transform: scale(0.98); }

        /* NFT & MEME */
        .nft-image { width:100%; border-radius:10px; margin-bottom:15px; object-fit: cover; height: 250px; }
        .meme-input { width:100%; background:#000; border:1px solid #333; padding:12px; color:white; border-radius:10px; margin-bottom:10px; }
        
        /* TOAST */
        #toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #222; color: white; padding: 12px 24px; border-radius: 30px;
            font-size: 13px; font-weight: 600; display: none; border: 1px solid #444; z-index: 999; white-space: nowrap;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">VIXE.</div>
        <button class="wallet-btn" id="walletBtn" onclick="connect()">Connect</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="go('swap',this)">Swap</button>
        <button class="tab-btn" onclick="go('nft',this)">NFT</button>
        <button class="tab-btn" onclick="go('meme',this)">Launch</button>
        <button class="tab-btn" onclick="go('earn',this)">Earn</button>
    </div>

    <div class="container">
        
        <div id="swap" class="view active">
            <div class="card">
                <div class="input-box">
                    <div class="input-col">
                        <span class="label">PAY (BNB)</span>
                        <input type="number" id="inpBNB" class="amount" placeholder="0.0" oninput="calc()">
                    </div>
                    <div class="token"><img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" alt="BNB Logo"> BNB</div>
                </div>

                <div class="swap-arrow"><div class="arrow-circle" onclick="swapTokenInput()"><i class="fas fa-arrow-down"></i></div></div>

                <div class="input-box">
                    <div class="input-col">
                        <span class="label">RECEIVE (VIXE)</span>
                        <input type="text" id="outVIXE" class="amount" placeholder="0.0" disabled style="color:#888">
                    </div>
                    
                    <div class="token" style="border:1px solid var(--primary)">
                        <img id="vixeLogo" src="https://cryptologos.cc/logos/polygon-matic-logo.png?v=029" alt="VIXE Logo"> 
                        VIXE
                    </div>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:12px; color:#666;">
                    <span>Rate</span>
                    <span id="rateTxt">-</span>
                </div>

                <button id="swapBtn" class="btn-main" onclick="doSwap()">CONNECT WALLET</button>
            </div>
            
            <div style="font-size:12px; color:#666; text-align:center; margin-top:10px;">
                Balance: <span id="balBNB" style="color:white">0</span> BNB | <span id="balVIXE" style="color:white">0</span> VIXE
            </div>
        </div>

        <div id="nft" class="view">
            <div class="card">
                <img id="nftImage" src="https://i.seadn.io/gcs/files/c3a312da536eb47461d94662c5242694.png?auto=format&w=500" class="nft-image" alt="NFT Preview">
                
                <div class="stat-row"><span>VIXE Genesis NFT</span><span style="color:#d946ef; font-weight:bold;">5,000 VIXE</span></div>
                <p style="font-size:12px; color:#999; margin-top:-10px; margin-bottom:15px;">Unlock exclusive features by minting our utility NFT.</p>
                <button id="btnNft" class="btn-main" onclick="payVixe(5000, 'NFT Minted Successfully')">MINT NFT</button>
            </div>
        </div>

        <div id="meme" class="view">
            <div class="card">
                <h3 style="margin-top:0">Deploy New Token (Meme)</h3>
                <input type="text" placeholder="Token Name (e.g. CyberDoge)" class="meme-input">
                <input type="text" placeholder="Symbol (e.g. CDOGE)" class="meme-input">
                <input type="number" placeholder="Total Supply (e.g. 1000000000)" class="meme-input">
                <div style="font-size:12px; color:#888; margin-bottom:10px;">Cost: <span style="color:#d946ef; font-weight:bold;">10,000 VIXE</span> (Token Creation & LP Lock)</div>
                <button id="btnMeme" class="btn-main" onclick="payVixe(10000, 'Token Deployed Successfully')">DEPLOY</button>
            </div>
        </div>

        <div id="earn" class="view">
            <div class="card" style="text-align:center; background:linear-gradient(135deg, #1a1a1a, #000);">
                <div style="font-size:11px; color:#888; letter-spacing:2px;">TOTAL VIXE POINTS</div>
                <div style="font-size:36px; font-weight:800; color:#d946ef;" id="pts">0</div>
            </div>
            <div class="card">
                <div class="task-row">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <i class="fab fa-twitter" style="color:#1DA1F2;"></i> <span>Share Twitter</span>
                    </div>
                    <button id="btnTw" class="task-btn" onclick="task('tw')">+50</button>
                </div>
                <div class="task-row">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <i class="fas fa-wallet" style="color:#ff9800;"></i> <span>Add Token to Wallet</span>
                    </div>
                    <button id="btnAdd" class="task-btn" onclick="task('add')">+10</button>
                </div>
            </div>
        </div>

    </div>

    <div id="toast">Notification</div>

    <script>
        // --- CONFIGURATION FIXED ---
        const TOKEN = "0xfdDe1BcAfcfAC533073230120f996E3FBBf1E050"; // ALAMAT TOKEN VIXE ANDA
        const ROUTER = "0xD99D1c33F9fC3444f8101754aBC46c52416550D1";
        const WBNB = "0xae13d989daC2f0dEbFf460aC112a837C89BAa7cd";
        const CHAIN = "0x61"; // 97 (BSC Testnet)
        
        // Alamat Admin/Burn/Penerima Pembayaran VIXE
        const ADMIN_WALLET = "0x473bfa02cd66b3981ec09cd52766f110c8f661fa";

        let provider, signer, user;
        let points = parseInt(localStorage.getItem('pts')||0);
        document.getElementById('pts').innerText = points.toLocaleString();

        // Init tasks
        let tasks = JSON.parse(localStorage.getItem('v13_tasks') || '{}');
        if(tasks.tw) markDone(document.getElementById('btnTw'));
        if(tasks.add) markDone(document.getElementById('btnAdd'));

        function go(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function toast(msg, err = false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.border = err ? "1px solid var(--error)" : "1px solid var(--success)";
            t.style.display = "block";
            setTimeout(() => t.style.display = "none", 3000);
        }

        async function connect() {
            if(!window.ethereum) return toast("No Wallet Found (Install MetaMask)", true);
            try {
                await window.ethereum.request({method:'eth_requestAccounts'});
                try { await window.ethereum.request({method:'wallet_switchEthereumChain', params:[{chainId:CHAIN}]}); } catch(e){}
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                user = await signer.getAddress();
                
                document.getElementById('walletBtn').innerText = user.substring(0,4)+"...";
                document.getElementById('walletBtn').classList.add('connected');
                document.getElementById('swapBtn').innerText = "SWAP NOW";
                
                updateBal();
                toast("Wallet Connected");
                
                // Auto refresh saldo setiap 5 detik
                setInterval(updateBal, 5000);

            } catch(e) { toast("Connection Failed", true); }
        }

        async function updateBal() {
            if(!user || !provider) return;
            try {
                const bnb = await provider.getBalance(user);
                document.getElementById('balBNB').innerText = parseFloat(ethers.utils.formatEther(bnb)).toFixed(4);
                
                const tc = new ethers.Contract(TOKEN, ["function balanceOf(address) view returns (uint)"], provider);
                const vixe = await tc.balanceOf(user);
                document.getElementById('balVIXE').innerText = parseFloat(ethers.utils.formatEther(vixe)).toFixed(2);
                calc(); // Update quote setelah balance
            } catch(e) { console.log("Bal update err", e); }
        }

        // --- SWAP LOGIC ---
        async function calc() {
            const val = document.getElementById('inpBNB').value;
            if(val <= 0 || !user || !provider) { 
                document.getElementById('outVIXE').value=""; 
                document.getElementById('rateTxt').innerText="-"; 
                return; 
            }
            try {
                const r = new ethers.Contract(ROUTER, ["function getAmountsOut(uint amountIn, address[] memory path) view returns (uint[] memory amounts)"], provider);
                const res = await r.getAmountsOut(ethers.utils.parseEther(val), [WBNB, TOKEN]);
                const out = parseFloat(ethers.utils.formatEther(res[1]));
                document.getElementById('outVIXE').value = out.toFixed(2);
                document.getElementById('rateTxt').innerText = `1 BNB â‰ˆ ${(out/val).toFixed(0)} VIXE`;
            } catch(e) { 
                document.getElementById('outVIXE').value="0.0"; 
                document.getElementById('rateTxt').innerText="Error: No Liquidity";
            }
        }
        
        function swapTokenInput() {
            // Fungsionalitas hanya untuk tampilan/visual. Logika swap tetap BNB -> VIXE.
            toast("Swap Token (Visual Only)", true);
        }

        async function doSwap() {
            if(!user) return connect();
            const val = document.getElementById('inpBNB').value;
            if(val <= 0) return toast("Enter valid BNB Amount", true);
            
            const btn = document.getElementById('swapBtn');
            btn.innerText = "Processing..."; btn.disabled = true;
            
            try {
                const r = new ethers.Contract(ROUTER, ["function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable"], signer);
                
                const tx = await r.swapExactETHForTokens(
                    0, [WBNB, TOKEN], user, Math.floor(Date.now()/1000)+600, 
                    { value: ethers.utils.parseEther(val), gasLimit: 500000 }
                );
                toast("Transaction Sent! Waiting for confirmation...");
                await tx.wait();
                toast("Swap Success!");
                addPts(100); updateBal();
                document.getElementById('inpBNB').value = ""; document.getElementById('outVIXE').value = "";
            } catch(e) { 
                let msg = "Swap Failed";
                if(e.message.includes("insufficient")) msg = "Insufficient BNB Balance";
                toast(msg, true); 
            } finally {
                btn.innerText = "SWAP NOW"; btn.disabled = false;
            }
        }

        // --- PAY WITH VIXE (NFT/MEME) ---
        async function payVixe(amount, successMsg) {
            if(!user) return connect();
            const btnId = amount === 5000 ? 'btnNft' : 'btnMeme';
            const btn = document.getElementById(btnId);
            const oldText = btn.innerText;
            btn.innerText = "Sending VIXE..."; btn.disabled = true;

            try {
                const tc = new ethers.Contract(TOKEN, ["function balanceOf(address) view returns (uint)", "function transfer(address, uint) returns (bool)"], signer);
                const bal = await tc.balanceOf(user);
                const cost = ethers.utils.parseEther(amount.toString());
                
                if(bal.lt(cost)) {
                     throw new Error(`Insufficient VIXE Balance. Need ${amount.toLocaleString()} VIXE.`);
                }

                // BUG FIX: Menambahkan gas limit yang cukup (500k) untuk transfer token agar tidak gagal di testnet/mainnet.
                const tx = await tc.transfer(ADMIN_WALLET, cost, { gasLimit: 500000 }); 
                
                toast("Transaction Sent! Waiting for confirmation...");
                await tx.wait();
                toast(successMsg);
                addPts(amount === 5000 ? 500 : 1000); 
                updateBal();
            } catch(e) { 
                let msg = e.message || "Transaction Failed";
                if(msg.includes("Insufficient VIXE")) msg = `ERROR: Insufficient VIXE Balance`;
                toast(msg, true); 
            } finally {
                btn.innerText = oldText; btn.disabled = false;
            }
        }

        // --- TASKS & POINTS ---
        function markDone(el) {
             el.innerText="COMPLETED"; 
             el.style.cssText = "background: #333; color: #888; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; border: none;";
             el.removeAttribute("onclick"); 
        }

        function task(t) {
            if(tasks[t]) return toast("Task Already Completed", true);

            if(t==='tw') { 
                window.open("https://twitter.com/intent/tweet?text=VIXE%20Testnet%20is%20Live!%20%23VIXE", "_blank"); 
                setTimeout(()=>{ 
                    if(confirm("Confirm you have shared on Twitter?")) {
                        tasks.tw = true;
                        localStorage.setItem('v13_tasks', JSON.stringify(tasks));
                        addPts(50);
                        markDone(document.getElementById('btnTw'));
                        toast("50 Points Added!");
                    } 
                }, 3000); 
            }
            if(t==='add') { 
                if(!user) return connect();
                window.ethereum.request({
                    method:'wallet_watchAsset',
                    params:{
                        type:'ERC20',
                        options:{address:TOKEN,symbol:'VIXE',decimals:18, image:document.getElementById('vixeLogo').src}
                    }
                }).then(() => {
                    tasks.add = true;
                                localStorage.setItem('v13_tasks', JSON.stringify(tasks));
                    addPts(10);
                    markDone(document.getElementById('btnAdd'));
                    toast("VIXE Added to Wallet! 10 Points Added.");
                }).catch(() => {
                    toast("Failed to Add Token", true);
                });
            }
        }

        function addPts(n) {
            points += n; localStorage.setItem('pts', points);
            document.getElementById('pts').innerText = points.toLocaleString();
        }

        // Auto Init
        if(window.ethereum && window.ethereum.selectedAddress) connect();
    </script>
</body>
</html>     
