<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIXE | Black Diamond</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { title: ['Syne', 'sans-serif'], sans: ['Inter', 'sans-serif'] },
                    colors: {
                        bg: '#030303',
                        card: 'rgba(15, 15, 20, 0.6)',
                        primary: '#7b2cbf', /* Royal Purple */
                        accent: '#4cc9f0', /* Diamond Blue */
                    },
                    animation: {
                        'float': 'float 8s ease-in-out infinite',
                        'glow': 'glow 3s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } },
                        glow: { '0%': { boxShadow: '0 0 20px rgba(123, 44, 191, 0.2)' }, '100%': { boxShadow: '0 0 50px rgba(123, 44, 191, 0.6)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #030303; color: white; overflow-x: hidden; perspective: 1000px; }
        
        /* --- MOVING BACKGROUND --- */
        .orb-container { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
        .orb { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.4; animation: float 10s infinite; }
        .orb-1 { top: -10%; left: -10%; width: 600px; height: 600px; background: #7b2cbf; animation-delay: 0s; }
        .orb-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: #4cc9f0; animation-delay: -5s; }
        .grid-bg {
            position: fixed; inset: 0; z-index: -1;
            background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px; mask-image: radial-gradient(circle, black 40%, transparent 100%);
        }

        /* --- 3D GLASS CARD --- */
        .diamond-card {
            background: rgba(20, 20, 25, 0.4);
            backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.05);
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }
        
        /* --- INPUTS --- */
        .lux-input {
            background: linear-gradient(145deg, rgba(0,0,0,0.6), rgba(20,20,20,0.4));
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }
        .lux-input:focus-within {
            border-color: var(--accent); box-shadow: 0 0 30px rgba(76, 201, 240, 0.15);
        }

        /* --- BUTTONS --- */
        .btn-royal {
            background: linear-gradient(135deg, #7b2cbf 0%, #3a0ca3 100%);
            position: relative; overflow: hidden; z-index: 1; border: none;
            box-shadow: 0 10px 30px -10px rgba(123, 44, 191, 0.6);
        }
        .btn-royal::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #4cc9f0 0%, #7b2cbf 100%);
            z-index: -1; transition: opacity 0.3s; opacity: 0;
        }
        .btn-royal:hover::before { opacity: 1; }
        .btn-royal:active { transform: scale(0.98); }
        .btn-royal:disabled { filter: grayscale(1); opacity: 0.5; cursor: not-allowed; }

        /* --- TOAST --- */
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-200%);
            background: rgba(10, 10, 15, 0.95); border: 1px solid rgba(255,255,255,0.1);
            z-index: 9999; transition: 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        #toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body class="antialiased">

    <div class="orb-container">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="grid-bg"></div>
    </div>

    <nav class="fixed w-full z-50 top-0 border-b border-white/5 bg-[#030303]/80 backdrop-blur-xl">
        <div class="max-w-md mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center shadow-[0_0_20px_rgba(123,44,191,0.4)]">
                    <i class="fas fa-gem text-white text-lg"></i>
                </div>
                <span class="font-title font-bold text-2xl tracking-wide text-white">VIXE</span>
            </div>
            <button id="connectBtn" onclick="connectWallet()" class="font-title font-bold text-xs bg-white/5 border border-white/10 px-5 py-2.5 rounded-full hover:bg-white/10 transition-all flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" id="statusDot"></div>
                <span id="walletText">CONNECT</span>
            </button>
        </div>
    </nav>

    <main class="pt-32 pb-36 px-4 max-w-md mx-auto min-h-screen relative z-10 perspective-container">
        
        <div class="diamond-card rounded-3xl p-6 mb-8 text-center relative group">
            <div class="absolute inset-0 bg-gradient-to-r from-primary/10 to-accent/10 opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
            <p class="text-xs font-bold text-gray-500 tracking-[0.3em] mb-2">TOTAL VOLUME</p>
            <h1 class="font-title text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400 drop-shadow-2xl" id="globalVol">0</h1>
            
            <div class="mt-6 pt-4 border-t border-white/5 flex justify-between items-center px-2">
                <div class="text-left">
                    <p class="text-[10px] text-gray-500 font-bold uppercase">Top Trader</p>
                    <p class="text-xs font-mono text-accent">0x4A...89B</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-gray-500 font-bold uppercase">Vol</p>
                    <p class="text-xs font-mono text-white">1.2M VIXE</p>
                </div>
            </div>
        </div>

        <div id="view-swap" class="block tilt-card">
            <div class="diamond-card rounded-[30px] p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-title text-xl font-bold">SWAP</h2>
                    <div class="bg-green-500/10 border border-green-500/20 text-green-400 px-3 py-1 rounded-full text-[10px] font-bold animate-pulse">
                        ● LIVE
                    </div>
                </div>

                <div class="lux-input rounded-2xl p-4 mb-2">
                    <div class="flex justify-between text-[11px] text-gray-400 mb-3 font-bold tracking-wide">
                        <span>PAY</span>
                        <span>BAL: <span id="balBNB" class="text-white">0.00</span></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <input type="number" id="inpAmt" class="bg-transparent text-3xl font-bold text-white w-[60%] outline-none font-title placeholder-gray-700" placeholder="0.0" oninput="getQuote()">
                        <div class="bg-black/60 border border-white/10 px-3 py-2 rounded-xl flex items-center gap-2">
                            <img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" class="w-6">
                            <span class="font-bold text-sm">BNB</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center -my-5 relative z-10">
                    <div class="w-12 h-12 bg-[#0c0c0e] border-4 border-[#020204] rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary/30">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>

                <div class="lux-input rounded-2xl p-4 mt-2 pt-6">
                    <div class="flex justify-between text-[11px] text-gray-400 mb-3 font-bold tracking-wide">
                        <span>RECEIVE</span>
                        <span>BAL: <span id="balVIXE" class="text-white">0.00</span></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <input type="text" id="outAmt" class="bg-transparent text-3xl font-bold text-gray-500 w-[60%] outline-none font-title" placeholder="0.0" disabled>
                        <div class="bg-primary/10 border border-primary/30 px-3 py-2 rounded-xl flex items-center gap-2 shadow-[0_0_15px_rgba(123,44,191,0.2)]">
                            <i class="fas fa-bolt text-primary"></i>
                            <span class="font-bold text-sm text-white">VIXE</span>
                        </div>
                    </div>
                </div>

                <div class="mt-5 flex justify-between text-xs font-mono text-gray-500 px-2">
                    <span>Rate</span>
                    <span id="rateTxt" class="text-accent">-</span>
                </div>

                <button id="swapBtn" onclick="handleSwap()" class="btn-royal w-full mt-6 py-5 rounded-2xl font-title font-bold text-white text-lg tracking-widest transition-all">
                    CONNECT WALLET
                </button>
                
                <div class="mt-6 pt-4 border-t border-white/10 grid grid-cols-2 gap-4 text-center">
                    <div>
                        <p class="text-[10px] text-gray-500 font-bold">MY VOLUME</p>
                        <p class="font-mono text-white font-bold" id="myVol">0.00</p>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500 font-bold">MY POINTS</p>
                        <p class="font-mono text-accent font-bold text-lg drop-shadow-[0_0_5px_#00f0ff]" id="myPts">0</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-hist" class="hidden mt-8 animate-slide-up">
            <h2 class="font-title text-xl font-bold mb-4 px-2">Transaction Log</h2>
            <div id="histLog" class="space-y-3">
                <div class="diamond-card p-6 rounded-2xl text-center text-gray-500 text-xs font-bold uppercase tracking-wider">No Data</div>
            </div>
        </div>

    </main>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-[#0c0c0e]/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-8 py-4 flex gap-12 shadow-[0_10px_40px_rgba(0,0,0,0.8)] z-50">
        <button class="nav-item text-accent transform scale-110 transition-all relative" onclick="nav('swap', this)">
            <i class="fas fa-retweet text-2xl filter drop-shadow-[0_0_8px_#00f0ff]"></i>
            <span class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-[9px] font-bold uppercase tracking-widest opacity-0 hover:opacity-100 transition-opacity">Swap</span>
        </button>
        <button class="nav-item text-gray-600 hover:text-white transition-all relative" onclick="nav('hist', this)">
            <i class="fas fa-history text-2xl"></i>
        </button>
    </div>

    <div id="toast" class="px-6 py-4 rounded-2xl flex items-center gap-4 border border-white/10 shadow-2xl backdrop-blur-xl">
        <div id="toastIcon" class="w-10 h-10 rounded-full flex items-center justify-center text-lg"></div>
        <div>
            <h4 class="font-bold text-sm text-white" id="toastTitle">Notification</h4>
            <p class="text-xs text-gray-400" id="toastMsg">Message body</p>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const CFG = {
            TOKEN: "0xfdDe1BcAfcfAC533073230120f996E3FBBf1E050", // ALAMAT ANDA
            ROUTER: "0xD99D1c33F9fC3444f8101754aBC46c52416550D1",
            WBNB: "0xae13d989daC2f0dEbFf460aC112a837C89BAa7cd",
            CHAIN: "0x61"
        };
        const SALT = "VIXE_TITAN_V27"; 

        // --- 3D TILT EFFECT (Visual Mewah) ---
        document.addEventListener('mousemove', (e) => {
            const card = document.querySelector('.tilt-card');
            if(!card) return;
            const xAxis = (window.innerWidth / 2 - e.pageX) / 25;
            const yAxis = (window.innerHeight / 2 - e.pageY) / 25;
            card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
        });

        // --- STATE SECURITY ---
        function hash(d) {
            let s = JSON.stringify(d) + SALT;
            let h = 0; for(let i=0;i<s.length;i++) h = Math.imul(31, h) + s.charCodeAt(i) | 0;
            return h.toString();
        }
        function getData(a) {
            const r = localStorage.getItem(`vx_${a}`);
            if(!r) return {v:0, p:0, s:0, h:[]};
            try { const p = JSON.parse(atob(r)); return hash(p.d)===p.s ? p.d : {v:0,p:0,s:0,h:[]}; } catch{ return {v:0,p:0,s:0,h:[]}; }
        }
        function saveData(a, d) {
            localStorage.setItem(`vx_${a}`, btoa(JSON.stringify({d:d, s:hash(d)})));
            updateUI(d);
        }

        let provider, signer, user, isConnected = false, userData = {v:0, p:0, s:0, h:[]};

        // --- UI LOGIC ---
        function toast(title, msg, err=false) {
            const t = document.getElementById('toast');
            const i = document.getElementById('toastIcon');
            document.getElementById('toastTitle').innerText = title;
            document.getElementById('toastMsg').innerText = msg;
            t.style.background = err ? 'rgba(20, 5, 5, 0.95)' : 'rgba(5, 20, 10, 0.95)';
            t.style.borderColor = err ? '#ff0055' : '#00ff9d';
            i.style.background = err ? 'rgba(255,0,85,0.2)' : 'rgba(0,255,157,0.2)';
            i.style.color = err ? '#ff0055' : '#00ff9d';
            i.innerHTML = `<i class="fas ${err ? 'fa-times' : 'fa-check'}"></i>`;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 4000);
        }

        function nav(id, el) {
            document.getElementById('view-swap').style.display = id==='swap'?'block':'none';
            document.getElementById('view-hist').style.display = id==='hist'?'block':'none';
            document.querySelectorAll('.nav-item').forEach(b=>{b.classList.remove('text-accent');b.classList.add('text-gray-600')});
            el.classList.add('text-accent');
        }

        function updateUI(d) {
            document.getElementById('myVol').innerText = d.v.toFixed(3) + ' BNB';
            document.getElementById('myPts').innerText = d.p;
            // Global Vol Animation
            setInterval(()=>{
                const b = 1500000 + Math.floor(Date.now()/10000);
                document.getElementById('globalVol').innerText = b.toLocaleString();
            }, 1000);
            // Hist
            const h = document.getElementById('histLog');
            if(d.h.length>0) {
                h.innerHTML = d.h.map(tx=>`
                <div class="glass p-4 rounded-xl flex justify-between items-center border border-white/5">
                    <div><div class="text-xs font-bold text-primary">SWAP</div><div class="text-[10px] text-gray-500 font-mono">${tx.hash}</div></div>
                    <div class="text-right"><div class="text-success font-bold">+${tx.pts} PTS</div><div class="text-[10px] text-gray-500">${tx.time}</div></div>
                </div>`).join('');
            }
        }

        // --- CORE ENGINE ---
        async function connectWallet() {
            if(!window.ethereum) return toast("Error", "Install MetaMask", true);
            document.getElementById('walletText').innerText = "LOADING...";
            try {
                const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
                try { await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: CFG.CHAIN }] }); }
                catch(e) { if(e.code===4902) await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [{ chainId:CFG.CHAIN, chainName:'BSC Testnet', rpcUrls:['https://data-seed-pre-1-s1.binance.org:8545/'], nativeCurrency:{name:'BNB',symbol:'tBNB',decimals:18}, blockExplorerUrls:['https://testnet.bscscan.com'] }] }); }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                user = accs[0];

                userData = getData(user);
                updateUI(userData);
                isConnected = true;

                document.getElementById('walletText').innerText = user.substring(0,4)+"...";
                document.getElementById('statusDot').className = "w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#00ff9d]";
                document.getElementById('swapBtn').innerText = "SWAP NOW";
                
                refreshBal();
                toast("Connected", "System Online");
                window.ethereum.on('accountsChanged', ()=>window.location.reload());

            } catch(e) { toast("Failed", "Connection Rejected", true); document.getElementById('walletText').innerText = "CONNECT"; }
        }

        async function refreshBal() {
            if(!user) return;
            const bnb = await provider.getBalance(user);
            document.getElementById('balBNB').innerText = parseFloat(ethers.utils.formatEther(bnb)).toFixed(4);
            const tc = new ethers.Contract(CFG.TOKEN, ["function balanceOf(address) view returns (uint)"], provider);
            const vixe = await tc.balanceOf(user);
            document.getElementById('balVIXE').innerText = parseFloat(ethers.utils.formatEther(vixe)).toFixed(2);
        }

        async function getQuote() {
            const val = document.getElementById('inpAmt').value;
            if(val<=0 || !user) { document.getElementById('outAmt').value=""; return; }
            try {
                const r = new ethers.Contract(CFG.ROUTER, ["function getAmountsOut(uint amountIn, address[] memory path) view returns (uint[] memory amounts)"], provider);
                const res = await r.getAmountsOut(ethers.utils.parseEther(val), [CFG.WBNB, CFG.TOKEN]);
                const out = parseFloat(ethers.utils.formatEther(res[1]));
                document.getElementById('outAmt').value = out.toFixed(2);
                document.getElementById('rateTxt').innerText = `1 BNB ≈ ${(out/val).toFixed(0)} VIXE`;
            } catch(e) { document.getElementById('outAmt').value="Err"; }
        }

        async function handleSwap() {
            if(!user) return connectWallet();
            const val = document.getElementById('inpAmt').value;
            if(val<=0) return toast("Error", "Invalid Amount", true);

            const btn = document.getElementById('swapBtn');
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> PROCESSING ONCHAIN...';
            btn.disabled = true;

            try {
                const router = new ethers.Contract(CFG.ROUTER, ["function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable", "function getAmountsOut(uint amountIn, address[] memory path) view returns (uint[] memory amounts)"], signer);
                
                const amts = await router.getAmountsOut(ethers.utils.parseEther(val), [CFG.WBNB, CFG.TOKEN]);
                // SLIPPAGE TOLERANCE: 20% (BRUTAL MODE FOR TESTNET)
                const min = amts[1].sub(amts[1].div(100).mul(20)); 

                // GAS LIMIT: 600,000 (BRUTAL MODE)
                const tx = await router.swapExactETHForTokens(
                    min, [CFG.WBNB, CFG.TOKEN], user, Math.floor(Date.now()/1000)+1200,
                    { value: ethers.utils.parseEther(val), gasLimit: 600000 }
                );

                toast("Broadcasted", "Waiting for confirmation...");
                await tx.wait();

                userData.s++;
                userData.v += parseFloat(val);
                let pts = 100;
                if(userData.s % 10 === 0) { pts += 5; toast("BONUS!", "+5 Points (Streak)"); }
                userData.p += pts;
                
                userData.h.unshift({ hash: tx.hash.substring(0,6), pts: pts, time: new Date().toLocaleTimeString() });
                saveData(user, userData);

                toast("Success", "Swap Completed!");
                document.getElementById('inpAmt').value="";
                refreshBal();

            } catch(e) {
                console.error(e);
                // Smart Error Message
                let m = "Transaction Failed";
                if(e.message.includes("insufficient")) m = "Insufficient BNB Balance";
                toast("Error", m, true);
            } finally {
                btn.innerText = "SWAP NOW"; btn.disabled = false;
            }
        }

        window.onload = () => { if(window.ethereum && window.ethereum.selectedAddress) connectWallet(); };
    </script>
</body>
</html>
